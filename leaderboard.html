<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æ’è¡Œæ¦œ - Kçº¿æŒ‘æˆ˜</title>
  <link rel="stylesheet" href="/static/assets/style.css" />
</head>
<body>
  <div class="container">
    <h1>ğŸ† æ’è¡Œæ¦œ</h1>
    <p>åŸºäºçœŸå®å†å²è¡Œæƒ…çš„é¢„æµ‹æŒ‘æˆ˜</p>

    <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
    <div class="tab-nav" id="tabs">
      <button class="tab-btn active" onclick="showTab('total')">æ€»æ¦œ</button>
      <button class="tab-btn" onclick="showTab('daily')">æ—¥é—´æ¦œ</button>
      <button class="tab-btn" onclick="showTab('intraday')">æ—¥å†…æ¦œ</button>
      <button class="tab-btn" onclick="showTab('commodity_futures')">å•†å“æœŸè´§</button>
      <button class="tab-btn" onclick="showTab('a_share')">Aè‚¡è‚¡ç¥¨</button>
      <button class="tab-btn" onclick="showTab('h_share')">æ¸¯è‚¡è‚¡ç¥¨</button>
      <button class="tab-btn" onclick="showTab('us_stock')">ç¾è‚¡è‚¡ç¥¨</button>
      <button class="tab-btn" onclick="showTab('crypto')">åŠ å¯†è´§å¸</button>
      <button class="tab-btn" onclick="showTab('weekly')">å‘¨æ¦œ</button>
      <button class="tab-btn" onclick="showTab('monthly')">æœˆæ¦œ</button>
    </div>

    <!-- è¡¨æ ¼å®¹å™¨ -->
    <div id="table-container">
      <table class="leaderboard-table">
        <thead>
          <tr>
            <th>æ’å</th>
            <th>æ˜µç§°</th>
            <th>æ­£ç¡®æ¬¡æ•°</th>
            <th>æ­£ç¡®ç‡</th>
            <th>æ€»å±€æ•°</th>
          </tr>
        </thead>
        <tbody id="leaderboard-body">
          <tr><td colspan="5">åŠ è½½ä¸­...</td></tr>
        </tbody>
      </table>
    </div>

    <footer>
      <a href="/">ğŸ  è¿”å›é¦–é¡µ</a> | 
      <a href="/my-games">ğŸ” æˆ‘çš„æˆ˜ç»©</a>
    </footer>
  </div>

  <script>
    // å®šä¹‰æ‰€æœ‰æ ‡ç­¾é¡µé…ç½®
    const TABS = {
      total: { 
        category: null, 
        timeframe: null, 
        title: "æ€»æ¦œ", 
        api: "/api/leaderboard" 
      },
      daily: { 
        category: null, 
        timeframe: 'daily', 
        title: "æ—¥é—´æ¦œ", 
        api: "/api/leaderboard" 
      },
      intraday: { 
        category: null, 
        timeframe: 'intraday', 
        title: "æ—¥å†…æ¦œ", 
        api: "/api/leaderboard" 
      },
      commodity_futures: { 
        category: 'commodity_futures', 
        timeframe: null, 
        title: "å•†å“æœŸè´§", 
        api: "/api/leaderboard" 
      },
      a_share: { 
        category: 'a_share', 
        timeframe: null, 
        title: "Aè‚¡è‚¡ç¥¨", 
        api: "/api/leaderboard" 
      },
      h_share: { 
        category: 'h_share', 
        timeframe: null, 
        title: "æ¸¯è‚¡è‚¡ç¥¨", 
        api: "/api/leaderboard" 
      },
      us_stock: { 
        category: 'us_stock', 
        timeframe: null, 
        title: "ç¾è‚¡è‚¡ç¥¨", 
        api: "/api/leaderboard" 
      },
      crypto: { 
        category: 'crypto', 
        timeframe: null, 
        title: "åŠ å¯†è´§å¸", 
        api: "/api/leaderboard" 
      },
      weekly: { 
        category: null, 
        timeframe: null, 
        title: "å‘¨æ¦œ", 
        api: "/api/leaderboard/weekly" 
      },
      monthly: { 
        category: null, 
        timeframe: null, 
        title: "æœˆæ¦œ", 
        api: "/api/leaderboard/monthly" 
      }
    };

    /**
     * åŠ è½½æ’è¡Œæ¦œæ•°æ®
     */
    async function loadLeaderboard(config) {
      const tbody = document.getElementById("leaderboard-body");
      tbody.innerHTML = `<tr><td colspan="5">åŠ è½½ä¸­...</td></tr>`;

      try {
        // æ„å»ºæŸ¥è¯¢å‚æ•°
        const params = new URLSearchParams();
        if (config.category) params.append('category', config.category);
        if (config.timeframe) params.append('timeframe', config.timeframe);

        const url = config.api + (params.toString() ? '?' + params.toString() : '');
        const res = await fetch(url);
        
        if (!res.ok) throw new Error(`HTTP ${res.status}`);

        const data = await res.json();

        if (!data.data || data.data.length === 0) {
          tbody.innerHTML = `<tr><td colspan="5">æš‚æ— æ•°æ®</td></tr>`;
          return;
        }

        // æ¸²æŸ“è¡¨æ ¼
        tbody.innerHTML = data.data.map((row, i) => {
          const accuracy = row.accuracy !== undefined ? `${parseFloat(row.accuracy).toFixed(1)}%` : '--';
          const totalGames = row.total_games || row.totalGames || 'æœªçŸ¥';
          return `
            <tr>
              <td><strong>${i + 1}</strong></td>
              <td>${row.nickname || 'åŒ¿åç©å®¶'}</td>
              <td><strong style="color:#1a73e8;">${row.correct_count || row.correctCount || 0}</strong></td>
              <td>${accuracy}</td>
              <td>${totalGames}</td>
            </tr>
          `;
        }).join('');

      } catch (e) {
        console.error("åŠ è½½æ’è¡Œæ¦œå¤±è´¥:", e);
        tbody.innerHTML = `<tr><td colspan="5">åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</td></tr>`;
      }
    }

    /**
     * åˆ‡æ¢æ ‡ç­¾é¡µ
     */
    function showTab(tabKey) {
      const config = TABS[tabKey];
      if (!config) return;

      // æ›´æ–°æŒ‰é’®çŠ¶æ€
      document.querySelectorAll(".tab-btn").forEach(btn => 
        btn.classList.remove("active")
      );
      event.target.classList.add("active");

      // åŠ è½½æ•°æ®
      loadLeaderboard(config);
    }

    // é¡µé¢åŠ è½½æ—¶é»˜è®¤æ˜¾ç¤ºâ€œæ€»æ¦œâ€
    window.onload = () => {
      showTab('total');
    };
  </script>
</body>
</html>

